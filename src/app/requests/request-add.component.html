<div class="container mt-4">
  <h1>Add Request</h1>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <form [formGroup]="form" (ngSubmit)="save()">
    <!-- Type -->
    <div class="mb-3">
      <label class="form-label">Type</label>
      <select class="form-select" formControlName="type">
        <option value="">-- Select Type --</option>
        <option *ngFor="let t of allowedTypes" [value]="t">
          {{ t | titlecase }}
        </option>
      </select>
    </div>

    <!-- Employee -->
    <div class="mb-3">
      <label class="form-label">Employee</label>
      <select class="form-select" formControlName="accountId">
        <option value="">-- Select Employee --</option>
        <option *ngFor="let e of employees" [value]="e.accountId">
          {{ e.displayName }}
        </option>
      </select>
    </div>

    <!-- Items -->
    <div class="mb-3">
      <label class="form-label">Items</label>
      <div formArrayName="items">
        <div *ngFor="let item of items.controls; let i = index" [formGroupName]="i" class="row g-2 mb-2">
          <div class="col">
            <input class="form-control" formControlName="name" placeholder="Item name" />
          </div>
          <div class="col-3">
            <input type="number" class="form-control" formControlName="quantity" min="1" />
          </div>
          <div class="col-auto">
            <button type="button" class="btn btn-danger" (click)="removeItem(i)">Remove</button>
          </div>
        </div>
      </div>
      <button type="button" class="btn btn-secondary mt-2" (click)="addItem()">Add Item</button>
    </div>

    <!-- Actions -->
    <div class="mt-3">
      <button type="submit" class="btn btn-success" [disabled]="submitting">
        <span *ngIf="submitting" class="spinner-border spinner-border-sm me-1"></span>
        Create
      </button>
      <button type="button" class="btn btn-secondary ms-2" (click)="cancel()">Cancel</button>
    </div>
  </form>
</div>
